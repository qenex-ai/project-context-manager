---
name: delete-credential
description: Delete a stored credential from system keychain
version: 1.0.0

frontmatter:
  usage: |
    /delete-credential --name <name> [--global]
  
  examples:
    - /delete-credential --name mev-private-key
    - /delete-credential --name old-api-key --global
    - /delete-credential --name compromised-key

  arguments:
    - name: --name
      description: Credential identifier to delete
      required: true
    - name: --global
      description: Delete from global store
      required: false
    - name: --force
      description: Skip confirmation prompt
      required: false

script: |
  #!/bin/bash
  set -e

  NAME=""
  GLOBAL="false"
  FORCE="false"

  while [[ $# -gt 0 ]]; do
    case $1 in
      --name)
        NAME="$2"
        shift 2
        ;;
      --global)
        GLOBAL="true"
        shift
        ;;
      --force)
        FORCE="true"
        shift
        ;;
      *)
        echo "Unknown argument: $1"
        exit 1
        ;;
    esac
  done

  if [ -z "$NAME" ]; then
    echo "Error: --name is required"
    exit 1
  fi

  PROJECT_ROOT=$(git rev-parse --show-toplevel 2>/dev/null || pwd)
  PROJECT_NAME=$(basename "$PROJECT_ROOT")

  if [ "$GLOBAL" = "true" ]; then
    SERVICE="claude-code:global:${NAME}"
    SCOPE="Global"
  else
    SERVICE="claude-code:${PROJECT_NAME}:${NAME}"
    SCOPE="Project: $PROJECT_NAME"
  fi

  # Check if credential exists
  SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
  CREDENTIAL=$(bash "$SCRIPT_DIR/../scripts/credentials/keychain-wrapper.sh" get "$SERVICE" 2>/dev/null || echo "")

  if [ -z "$CREDENTIAL" ]; then
    echo "✗ Credential '$NAME' not found"
    echo "  Scope: $SCOPE"
    exit 1
  fi

  # Confirmation prompt (unless --force)
  if [ "$FORCE" != "true" ]; then
    echo "⚠️  Delete credential '$NAME'?"
    echo "   Scope: $SCOPE"
    echo ""
    read -p "   Type 'yes' to confirm: " CONFIRM
    if [ "$CONFIRM" != "yes" ]; then
      echo "✗ Deletion cancelled"
      exit 0
    fi
  fi

  # Delete credential
  bash "$SCRIPT_DIR/../scripts/credentials/keychain-wrapper.sh" delete "$SERVICE"

  echo "✓ Credential '$NAME' deleted successfully"
  echo "  Scope: $SCOPE"
