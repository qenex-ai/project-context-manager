---
name: get-credential
description: Retrieve stored credential from system keychain
version: 1.0.0

frontmatter:
  usage: |
    /get-credential --name <name> [--global]
  
  examples:
    - /get-credential --name mev-private-key
    - /get-credential --name github-api --global

  arguments:
    - name: --name
      description: Credential identifier
      required: true
    - name: --global
      description: Retrieve from global store
      required: false

script: |
  #!/bin/bash
  set -e

  NAME=""
  GLOBAL="false"

  while [[ $# -gt 0 ]]; do
    case $1 in
      --name)
        NAME="$2"
        shift 2
        ;;
      --global)
        GLOBAL="true"
        shift
        ;;
      *)
        echo "Unknown argument: $1"
        exit 1
        ;;
    esac
  done

  if [ -z "$NAME" ]; then
    echo "Error: --name is required"
    exit 1
  fi

  PROJECT_ROOT=$(git rev-parse --show-toplevel 2>/dev/null || pwd)
  PROJECT_NAME=$(basename "$PROJECT_ROOT")

  if [ "$GLOBAL" = "true" ]; then
    SERVICE="claude-code:global:${NAME}"
  else
    SERVICE="claude-code:${PROJECT_NAME}:${NAME}"
  fi

  SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
  CREDENTIAL=$(bash "$SCRIPT_DIR/../scripts/credentials/keychain-wrapper.sh" get "$SERVICE")

  if [ -z "$CREDENTIAL" ]; then
    echo "Error: Credential '$NAME' not found"
    exit 1
  fi

  echo "$CREDENTIAL"
